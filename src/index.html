<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx"
            crossorigin="anonymous"
        />

        <title>Free Storage</title>

        <script>
            // @ts-check

            document.addEventListener("DOMContentLoaded", async () => {
                /** @type {HTMLFormElement} */
                const form = document.querySelector("#upload-form");
                /** @type {HTMLInputElement} */
                const files = document.querySelector("#files");
                const output = document.querySelector("#output");

                form.addEventListener("submit", async (e) => {
                    e.preventDefault();

                    for (const file of files.files) {
                        (async () => {
                            const response = await fetch("/upload", {
                                method: "POST",
                                body: file,
                                headers: {
                                    "X-File-Name": file.name
                                }
                            });
                            const fileId = await response.json();
                            const url = `${
                                window.location.origin
                            }/get?${new URLSearchParams(fileId)}`;
                            const link = document.createElement("a");
                            link.href = url;
                            link.innerText = url;
                            link.target = "_blank";
                            output.appendChild(link);
                        })();
                    }
                });
            });
        </script>

        <style>
            * {
                font-family: "Gill Sans", "Gill Sans MT", Calibri,
                    "Trebuchet MS", sans-serif;
                font-size: 1em;
            }
            #upload-form {
                width: 50%;
                margin: auto;
            }
            #output > a {
                margin: 0.5em;
                display: block;
            }
        </style>
    </head>
    <body class="text-center mt-5">
        <form id="upload-form">
            <input
                class="form-control"
                type="file"
                name="file"
                id="files"
                multiple
            />
            <input class="btn btn-primary mt-3" type="submit" value="Upload" />
        </form>
        <div class="mt-5">
            Your download URLs are:

            <span id="output"></span>
        </div>
    </body>
</html>
